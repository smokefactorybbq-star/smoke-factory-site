<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smoke Factory BBQ ‚Äî –î–æ—Å—Ç–∞–≤–∫–∞</title>
  <style>
    :root{
      --accent:#16a34a; /* –∑–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
      --accent-weak:#9ae6b4;
      --danger:#dc2626;
      --bg:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
      --card:#f8fafc;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit}
    /* HEADER */
    header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border)}
    .header-inner{max-width:1280px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:16px}
    .logo{display:flex;align-items:center;gap:10px}
    .logo img{height:42px;width:auto;border-radius:8px}
    nav{display:flex;gap:10px;flex-wrap:wrap}
    .nav-btn{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer}
    .nav-btn:hover{background:#f3f4f6}

    /* LAYOUT */
    .page{max-width:1280px;margin:0 auto;padding:16px;display:grid;grid-template-columns:2fr 1fr;gap:24px}
    @media (max-width:1024px){.page{grid-template-columns:1fr}}

    /* MENU GRID */
    .menu{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:1200px){.menu{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.menu{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:200px;object-fit:cover}
    .card-body{padding:12px 14px;display:flex;flex-direction:column;gap:8px}
    .title{font-weight:700}
    .desc{color:var(--muted);font-size:14px}
    .price{font-weight:800}
    .add-btn{margin-top:auto;background:var(--accent);color:#fff;border:none;border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer}
    .add-btn:active{transform:translateY(1px)}

    /* CATEGORY TITLES */
    .cat-title{margin:24px 0 8px;font-size:22px;border-left:4px solid var(--accent);padding-left:8px}

    /* CART */
    .cart{position:sticky;top:84px;border:1px solid var(--border);border-radius:22px;background:#fff;padding:0;overflow:hidden;height:fit-content}
    .cart-header{display:flex;align-items:center;gap:8px;padding:12px 14px;border-bottom:1px solid var(--border);background:#f9fafb}
    .cart-header .pill{margin-left:auto;border:1px dashed var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted);display:flex;align-items:center;gap:6px}
    .cart-body{padding:12px 14px;display:flex;flex-direction:column;gap:10px}
    .link{color:#2563eb;cursor:pointer;text-decoration:underline}
    .summary{font-size:14px;color:var(--muted)}

    .cart-item{display:grid;grid-template-columns:48px 1fr auto;gap:10px;align-items:center;border-bottom:1px dashed var(--border);padding:10px 0}
    .qty{display:inline-flex;align-items:center;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .qty button{border:none;background:#fff;width:28px;height:28px;cursor:pointer}
    .qty span{padding:0 10px}
    .totals{margin-top:8px;border-top:1px solid var(--border);padding-top:10px;display:flex;flex-direction:column;gap:6px}
    .checkout{margin-top:8px;background:var(--accent);color:#fff;border:none;border-radius:14px;padding:12px;font-weight:800;cursor:pointer;width:100%}
    .checkout:disabled{background:#d1d5db;color:#6b7280;cursor:not-allowed}
    .remove{background:none;border:none;color:var(--danger);cursor:pointer;font-size:12px}

    /* MODALS */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:100}
    .modal{width:min(680px,92vw);background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.2);overflow:hidden}
    .modal header{position:sticky;top:0;border-bottom:1px solid var(--border)}
    .modal .content{padding:16px;display:flex;flex-direction:column;gap:12px}
    .modal .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:640px){.modal .row{grid-template-columns:1fr}}
    .modal footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border:none}
    .btn:disabled{background:#e5e7eb;color:#9ca3af;border-color:#e5e7eb;cursor:not-allowed}
    .tabs{display:flex;gap:8px}
    .tab{padding:8px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
    .tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    .input{width:100%;padding:12px 12px;border:1px solid var(--border);border-radius:12px}
    .input:focus{outline:none;border-color:#94a3b8;box-shadow:0 0 0 3px #e2e8f0}

    /* phone +66 prefix */
    .phone-wrap{display:flex;align-items:stretch;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .phone-prefix{display:flex;align-items:center;padding:0 10px;background:#f1f5f9;border-right:1px solid var(--border)}
    .phone-input{border:none;flex:1;padding:12px}
    .phone-input:focus{outline:none}

    /* Google map area */
    #map{width:100%;height:300px;border-radius:12px;border:1px solid var(--border)}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="logo">
      <img src="/images/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" />
      <strong>Smoke Factory BBQ ‚Äî –î–æ—Å—Ç–∞–≤–∫–∞</strong>
    </div>
    <nav id="top-nav"></nav>
  </div>
</header>

<main class="page">
  <!-- LEFT: MENU -->
  <section>
    <div id="menu-root"></div>
  </section>

  <!-- RIGHT: CART -->
  <aside class="cart" id="cart">
    <div class="cart-header">
      <strong>–ú–æ–π –∑–∞–∫–∞–∑</strong>
      <span class="pill">üì¶ –î–æ—Å—Ç–∞–≤–∫–∞</span>
    </div>
    <div class="cart-body">
      <div><span class="link" id="addressTrigger">–£–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å</span></div>
      <div id="addressSummary" class="summary"></div>
      <div id="cartItems"></div>
      <div class="totals">
        <div class="summary">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏: <span id="delivery-fee">0</span> ‡∏ø</div>
        <div class="summary">–°—É–º–º–∞ –±–ª—é–¥: <span id="items-total">0</span> ‡∏ø</div>
        <div class="summary"><strong>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: <span id="grand-total">0</span> ‡∏ø</strong></div>
      </div>
      <button id="checkoutBtn" class="checkout" disabled>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </aside>
</main>

<!-- ADDRESS MODAL -->
<div class="modal-backdrop" id="addrModal">
  <div class="modal">
    <header class="header-inner" style="justify-content:space-between">
      <strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</strong>
      <button class="btn" onclick="closeAddrModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </header>
    <div class="content">
      <div class="tabs">
        <button class="tab active" id="tab-manual">–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</button>
        <button class="tab" id="tab-map">–£–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
      </div>
      <div id="manualForm">
        <input id="addrInput" class="input" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" />
        <div class="row">
          <input id="nameInput" class="input" placeholder="–ò–º—è" />
          <div class="phone-wrap">
            <div class="phone-prefix">+66</div>
            <input id="phoneInput" class="phone-input" inputmode="numeric" maxlength="10" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (10 —Ü–∏—Ñ—Ä)" />
          </div>
        </div>
      </div>
      <div id="mapForm" style="display:none">
        <input id="placeSearch" class="input" placeholder="–ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å (Phuket)" />
        <div id="map"></div>
      </div>
      <div class="muted">–ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å¬ª —Å—Ç–∞–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.</div>
    </div>
    <footer>
      <button class="btn" onclick="closeAddrModal()">–û—Ç–º–µ–Ω–∞</button>
      <button id="addrConfirm" class="btn primary" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </footer>
  </div>
</div>

<!-- TIME MODAL -->
<div class="modal-backdrop" id="timeModal">
  <div class="modal">
    <header class="header-inner" style="justify-content:space-between">
      <strong>–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</strong>
      <button class="btn" onclick="closeTimeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </header>
    <div class="content">
      <label style="display:flex;align-items:center;gap:8px">
        <input type="radio" name="ordertime" value="asap" checked /> –ë–ª–∏–∂–∞–π—à–µ–µ
      </label>
      <label style="display:flex;align-items:center;gap:8px">
        <input type="radio" name="ordertime" value="scheduled" /> –í—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è
      </label>
      <div class="row" id="timePickers" style="display:none">
        <select id="hourSel" class="input"></select>
        <select id="minSel" class="input"></select>
      </div>
    </div>
    <footer>
      <button class="btn" onclick="closeTimeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button id="timeConfirm" class="btn primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
    </footer>
  </div>
</div>

<script>
  /********************** CONFIG **********************/
  // 1) –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–∫–∞–∑ (–≤–∞—à –±–µ–∫–µ–Ω–¥/–Ω–≥—Ä–æ–∫/—Å–µ—Ä–≤–µ—Ä –±–æ—Ç–∞)
  const ORDER_API_URL = "https://YOUR-NGROK-OR-SERVER/order"; // –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL
  // 2) –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–º–æ–∂–µ—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å –∏–ª–∏ –≤—ã—á–∏—Å–ª—è—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
  const DELIVERY_FEE_DEFAULT = 100;
  // 3) –ö–ª—é—á Google Maps (–Ω–∏–∂–µ –≤ —Ç–µ–≥–µ <script> –Ω—É–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–ª—é—á)

  /********************** DATA **********************/
  const CATEGORIES = {
    "–°—É–ø—ã": [
      {name:"–ë–æ—Ä—â", img:"/images/Borsht1.jpeg", price:130, desc:"–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –Ω–∞–≤–∞—Ä–∏—Å—Ç—ã–π –±–æ—Ä—â. –ü–æ–¥–∞–µ—Ç—Å—è —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π, —Å–∞–ª–æ–º –∏ —Ä—É—Å—Å–∫–æ–π –≥–æ—Ä—á–∏—Ü–µ–π. 300 –≥—Ä–∞–º–º"},
      {name:"–°–æ–ª—è–Ω–∫–∞", img:"/images/Solyanka1.jpeg", price:130, desc:"–°–±–æ—Ä–Ω–∞—è —Å–æ–ª—è–Ω–∫–∞ —Å –∫–æ–ø—á–µ–Ω–æ—Å—Ç—è–º–∏. –ü–æ–¥–∞–µ—Ç—Å—è —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π –∏ –ª–∏–º–æ–Ω–æ–º. 300 –≥—Ä–∞–º–º"},
      {name:"–ì–æ—Ä–æ—Ö–æ–≤—ã–π —Å—É–ø", img:"/images/goroh%20soup1.jpeg", price:130, desc:"–ì–æ—Ä–æ—Ö–æ–≤—ã–π —Å—É–ø –Ω–∞ –∫–æ–ø—á–µ–Ω—ã—Ö —Ä–µ–±—Ä–∞—Ö —Å —Å—É—Ö–∞—Ä–∏–∫–∞–º–∏. 300 –≥—Ä–∞–º–º"},
    ],
    "–û—Å–Ω–æ–≤–Ω—ã–µ –±–ª—é–¥–∞": [
      {name:"–ö–æ—Ç–ª–µ—Ç—ã –∫—É—Ä–∏–Ω—ã–µ", img:"/images/kyrinie%20kotlety1.jpeg", price:140, desc:"–ö–æ—Ç–ª–µ—Ç—ã –∏–∑ –º—è–∫–æ—Ç–∏ –±–µ–¥—Ä–∞. –ü–æ–¥–∞—é—Ç—Å—è —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–º –ø—é—Ä–µ. 300 –≥—Ä–∞–º–º"},
      {name:"–í–∞—Ä–µ–Ω–∏–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π –∏ –±–µ–∫–æ–Ω–æ–º", img:"/images/vareniki1.jpeg", price:110, desc:"–í–∞—Ä–µ–Ω–∏–∫–∏ —Ä—É—á–Ω–æ–π –ª–µ–ø–∫–∏ —Å –∫–æ–ø—á–µ–Ω—ã–º –±–µ–∫–æ–Ω–æ–º –∏ –Ω–µ–∂–Ω—ã–º –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–º –ø—é—Ä–µ. –ü–æ–¥–∞—é—Ç—Å—è —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π –∏ –∑–µ–ª–µ–Ω—å—é. 300 –≥—Ä–∞–º–º"},
      {name:"–ü–µ–ª—å–º–µ–Ω–∏", img:"/images/pelmeni1.jpeg", price:130, desc:"–ü–µ–ª—å–º–µ–Ω–∏ —Ä—É—á–Ω–æ–π –ª–µ–ø–∫–∏ —Å —Ñ–∞—Ä—à–µ–º –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã –∏ –≥–æ–≤—è–¥–∏–Ω—ã. –ü–æ–¥–∞—é—Ç—Å—è —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π. 300 –≥—Ä–∞–º–º"},
      {name:"–ö–æ—Ç–ª–µ—Ç—ã –∏–∑ –¥–æ–º–∞—à–Ω–µ–≥–æ —Ñ–∞—Ä—à–∞", img:"/images/kotletyi%20iz%20farsha1.jpeg", price:150, desc:"–°–æ—á–Ω—ã–µ –∏ –∞—Ä–æ–º–∞—Ç–Ω—ã–µ –∫–æ—Ç–ª–µ—Ç—ã, —Ç—É—à–µ–Ω—ã–µ –¥–æ –Ω–∞—Å—ã—â–µ–Ω–Ω–æ–≥–æ –≤–∫—É—Å–∞.–ü–æ–¥–∞—é—Ç—Å—è —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–º –ø—é—Ä–µ. 350 –≥—Ä–∞–º–º"},
      {name:"–ü–µ—Ä–µ—Ü —Ñ–∞—Ä—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", img:"/images/farshirovannii%20perec1.jpeg", price:150, desc:" –ü–µ—Ä–µ—Ü —Å –¥–æ–º–∞—à–Ω–∏–º —Ñ–∞—Ä—à–µ–º, —Ç–æ–º–ª–µ–Ω—ã–π —Å –æ–≤–æ—â–∞–º–∏. –ü–æ–¥–∞–µ—Ç—Å—è —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π.400 –≥—Ä–∞–º–º"},
      {name:"–ë–µ—Ñ—Å—Ç—Ä–æ–≥–∞–Ω–æ–≤", img:"/images/befstroganof.jpeg", price:180, desc:"–ù–µ–∂–Ω–∞—è –≥–æ–≤—è–¥–∏–Ω–∞ –≤ —Å–ª–∏–≤–æ—á–Ω–æ–º —Å–æ—É—Å–µ —Å –≥—Ä–∏–±–∞–º–∏. –ü–æ–¥–∞–µ—Ç—Å—è —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–º –ø—é—Ä–µ. 320 –≥—Ä–∞–º–º"},
      {name:"–õ–µ–ø–µ—à–∫–∞ —Å —Å—ã—Ä–æ–º", img:"/images/lepeshka%20s%20sirom1.jpeg", price:70, desc:"–†—É–º—è–Ω–∞—è –¥—Ä–æ–∂–∂–µ–≤–∞—è –ª–µ–ø–µ—à–∫–∞ —Å —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω—ã–º —Å—ã—Ä–æ–º –≤ –º—è–≥–∫–æ–º —Ç–µ—Å—Ç–µ, –æ–±–∂–∞—Ä–µ–Ω–Ω–∞—è –¥–æ —Ö—Ä—É—Å—Ç—è—â–µ–π –∫–æ—Ä–æ—á–∫–∏. 100 –≥—Ä–∞–º–º"},
      {name:"–õ–µ–ø–µ—à–∫–∞ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π", img:"/images/lepeshka%20s%20sirom1.jpeg", price:70, desc:"–†—É–º—è–Ω–∞—è –¥—Ä–æ–∂–∂–µ–≤–∞—è –ª–µ–ø–µ—à–∫–∞ —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ –ø—ã—à–Ω–æ–≥–æ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω–æ–≥–æ –ø—é—Ä–µ –∏ –∞—Ä–æ–º–∞—Ç–Ω–æ–π –∑–µ–ª–µ–Ω–∏. –ú—è–≥–∫–∞—è, —Å—ã—Ç–Ω–∞—è, —Å —Ö—Ä—É—Å—Ç—è—â–µ–π –∫–æ—Ä–æ—á–∫–æ–π. 100 –≥—Ä–∞–º–º"},
      {name:"–õ–µ–ø–µ—à–∫–∞ —Å –º—è—Å–æ–º", img:"/images/lepeshka%20s%20sirom1.jpeg", price:100, desc:"–†—É–º—è–Ω–∞—è –¥—Ä–æ–∂–∂–µ–≤–∞—è –ª–µ–ø–µ—à–∫–∞ —Å —Å–æ—á–Ω–æ–π –º—è—Å–Ω–æ–π –Ω–∞—á–∏–Ω–∫–æ–π.100 –≥—Ä–∞–º–º"},
      {name:"–ö–æ—Ç–ª–µ—Ç–∞ –ø–æ-–∫–∏–µ–≤—Å–∫–∏", img:"/images/kotleta%20po%20kievski.jpeg", price:160, desc:"–°–æ—á–Ω–æ–µ –∫—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ –≤ —Ö—Ä—É—Å—Ç—è—â–µ–π –ø–∞–Ω–∏—Ä–æ–≤–∫–µ —Å–æ —Å–ª–∏–≤–æ—á–Ω—ã–º –º–∞—Å–ª–æ–º –∏ –∞—Ä–æ–º–∞—Ç–Ω–æ–π –∑–µ–ª–µ–Ω—å—é. –ü–æ–¥–∞–µ—Ç—Å—è —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω—ã–º–∏ –¥–æ–ª—å–∫–∞–º–∏. 310 –≥—Ä–∞–º–º"},
      {name:"–ö–∞—Ä—Ç–æ—à–∫–∞ —Ñ—Ä–∏", img:"/images/kart%20fri.jpeg", price:100, desc:"–ü–æ–¥–∞–µ—Ç—Å—è —Å –∫–µ—Ç—á—É–ø–æ–º. 150 –≥—Ä–∞–º–º"},
      {name:"–ö–∞—Ä—Ç–æ—à–∫–∞ –¥–æ–ª—å–∫–∞–º–∏", img:"/images/kart%20dolki.jpeg", price:100, desc:"–ü–æ–¥–∞–µ—Ç—Å—è —Å –∫–µ—Ç—á—É–ø–æ–º. 150 –≥—Ä–∞–º–º"},
      {name:"–ú–∏–Ω–∏ —á–µ–±—É—Ä–µ–∫–∏", img:"/images/min%20chebureki.jpeg", price:150, desc:"–•—Ä—É—Å—Ç—è—â–∏–µ –º–∏–Ω–∏ —á–µ–±—É—Ä–µ–∫–∏ —Å –º—è—Å–Ω–æ–π –Ω–∞—á–∏–Ω–∫–æ–π. –ü–æ–¥–∞—é—Ç—Å—è —Å –∞–¥–∂–∏–∫–æ–π. 180 –≥—Ä–∞–º–º"},
    ],
    "–°–∞–ª–∞—Ç—ã": [
      {name:"–°–∞–ª–∞—Ç –¶–µ–∑–∞—Ä—å —Å –∫–æ–ø—á–µ–Ω–æ–π –∫—É—Ä–∏—Ü–µ–π", img:"/images/salat%20cezar.jpeg", price:140, desc:"–°–≤–µ–∂–∏–µ –ª–∏—Å—Ç—å—è —Å–∞–ª–∞—Ç–∞, —á–µ—Ä—Ä–∏, —Ö—Ä—É—Å—Ç—è—â–∏–µ —Å—É—Ö–∞—Ä–∏–∫–∏ –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–æ—É—Å –¶–µ–∑–∞—Ä—å.–û—Å–Ω–æ–≤–∞ –±–ª—é–¥–∞ - —Ñ–∏—Ä–º–µ–Ω–Ω–∞—è –∫–æ–ø—á–µ–Ω–∞—è –≥—Ä—É–¥–∫–∞ –∏ –ø–∞—Ä–º–µ–∑–∞–Ω. 200 –≥—Ä–∞–º–º"},
      {name:"–°–∞–ª–∞—Ç —Å —Ç—É–Ω—Ü–æ–º", img:"/images/salat%20s%20tunec.jpeg", price:130, desc:"–õ–µ–≥–∫–∏–π –∏ —Å—ã—Ç–Ω—ã–π —Å–∞–ª–∞—Ç –∏–∑ –∫–æ–Ω—Å–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç—É–Ω—Ü–∞, –ª–∏—Å—Ç—å–µ–≤ —Å–∞–ª–∞—Ç–∞, –≤–∞—Ä–µ–Ω–æ–≥–æ —è–π—Ü–∞ –∏ —Ö—Ä—É—Å—Ç—è—â–∏—Ö –æ–≥—É—Ä—Ü–æ–≤. –ó–∞–ø—Ä–∞–≤–ª–µ–Ω –∞—Ä–æ–º–∞—Ç–Ω—ã–º –º–∞—Å–ª–æ–º . 190 –≥—Ä–∞–º–º"},
      {name:"–°–∞–ª–∞—Ç –±–∞–∫–ª–∞–∂–∞–Ω—ã –≤ –∫–ª—è—Ä–µ", img:"/images/salat%20baklajani.jpeg", price:130, desc:"–û–±–∂–∞—Ä–µ–Ω–Ω—ã–µ –≤–æ —Ñ—Ä–∏—Ç—é—Ä–µ –ª–æ–º—Ç–∏–∫–∏ –±–∞–∫–ª–∞–∂–∞–Ω–æ–≤ –≤ —Ö—Ä—É—Å—Ç—è—â–µ–π –∫—Ä–∞—Ö–º–∞–ª—å–Ω–æ–π –∫–æ—Ä–æ—á–∫–µ,—Å —Ç–æ–º–∞—Ç–∞–º–∏ —á–µ—Ä—Ä–∏, –∑–µ–ª–µ–Ω—å—é –∏ –ø–∏–∫–∞—Ç–Ω—ã–º —Å–æ—É—Å–æ–º —Å–≤–∏—Ç-—á–∏–ª–ª–∏. 160 –≥—Ä–∞–º–º"},
    ],
    "–ì—Ä–∏–ª—å": [
      {name:"–†–µ–±—Ä–∞ BBQ", img:"/images/Rebra%20BBQ1.jpeg", price:300, desc:"–†–µ–±—Ä–∞ –±–∞—Ä–±–µ–∫—é, –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–æ–º low and slow, –≥–ª–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–º —Å–æ—É—Å–æ–º.320 –≥—Ä–∞–º–º"},
      {name:"–ö–µ–±–∞–± —Å–≤–∏–Ω–∏–Ω–∞-–≥–æ–≤—è–¥–∏–Ω–∞", img:"/images/kebab%20pork-beef1.jpeg", price:170, desc:"–°–æ—á–Ω—ã–π –∫–µ–±–∞–±, –ø—Ä–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–ø–µ—Ü–∏—è–º–∏ –∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –≤ —Å–º–æ–∫–µ—Ä–µ. –ü–æ–¥–∞–µ—Ç—Å—è —Å –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–º –ª—É–∫–æ–º, —Å–≤–µ–∂–∏–º–∏ –æ–≤–æ—â–∞–º–∏ –∏ –∞–¥–∂–∏–∫–æ–π. 250 –≥—Ä–∞–º–º"},
      {name:"–ö–µ–±–∞–± –∏–∑ –∫—É—Ä–∏—Ü—ã", img:"/images/kebab%20chicken1.jpeg", price:150, desc:"–ù–µ–∂–Ω–∞—è –∫—É—Ä–∏—Ü–∞ —Å –ø—Ä—è–Ω—ã–º–∏ —Å–ø–µ—Ü–∏—è–º–∏. –°–æ—á–Ω–æ–µ –º—è—Å–æ —Å —è—Ä–∫–∏–º –≤–∫—É—Å–æ–º, –∫–æ—Ç–æ—Ä–æ–µ —Ç–∞–µ—Ç –≤–æ —Ä—Ç—É. –ü–æ–¥–∞–µ—Ç—Å—è —Å –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–º –ª—É–∫–æ–º, —Å–≤–µ–∂–∏–º–∏ –æ–≤–æ—â–∞–º–∏ –∏ –∞–¥–∂–∏–∫–æ–π. 250 –≥—Ä–∞–º–º"},
      {name:"–®–∞—à–ª—ã–∫ –∏–∑ –∫—É—Ä–∏—Ü—ã", img:"/images/shashlik%20iz%20kyrica.jpeg", price:140, desc:"–°–æ—á–Ω–æ–µ –º—è—Å–æ –∫—É—Ä–∏–Ω–æ–≥–æ –±–µ–¥—Ä–∞, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω–æ–µ –≤ —Å–ø–µ—Ü–∏—è—Ö.–ü–æ–¥–∞–µ—Ç—Å—è —Å –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–º –ª—É–∫–æ–º, —Å–≤–µ–∂–∏–º–∏ –æ–≤–æ—â–∞–º–∏ –∏ –∞–¥–∂–∏–∫–æ–π. –ü–æ–¥–∞–µ—Ç—Å—è —Å –æ–≤–æ—â–∞–º–∏ –∏ –ª–∞–≤–∞—à–æ–º. 200 –≥—Ä–∞–º–º"},
      {name:"–®–∞—à–ª—ã–∫ –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã", img:"/images/shashlik%20iz%20svinini1.jpeg", price:160, desc:"–°–æ—á–Ω—ã–π —à–∞—à–ª—ã–∫ —Å –¥—ã–º–∫–æ–º - –Ω–µ–∂–Ω—ã–µ –∫—É—Å–æ—á–∫–∏ —Å–≤–∏–Ω–∏–Ω—ã, –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤ –∞–≤—Ç–æ—Ä—Å–∫–æ–º –º–∞—Ä–∏–Ω–∞–¥–µ. –ü–æ–¥–∞–µ—Ç—Å—è —Å –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–º –ª—É–∫–æ–º, —Å–≤–µ–∂–∏–º–∏ –æ–≤–æ—â–∞–º–∏ –∏ –∞–¥–∂–∏–∫–æ–π.260 –≥—Ä–∞–º–º"},
    ],
    "–ó–∞–º–æ—Ä–æ–∑–∫–∞": [
      {name:"–ü–µ–ª—å–º–µ–Ω–∏ 1–∫–≥", img:"/images/pelmeni%201kg.jpeg", price:300, desc:"–ü–µ–ª—å–º–µ–Ω–∏ –∏–∑ —Ñ–∞—Ä—à–∞ —Å–≤–∏–Ω–∏–Ω—ã –∏ –≥–æ–≤—è–¥–∏–Ω—ã."},
      {name:"–í–∞—Ä–µ–Ω–∏–∫–∏ 1–∫–≥", img:"/images/vereniki%201kg.jpeg", price:250, desc:"–í–∞—Ä–µ–Ω–∏–∫–∏ —Å –∫–∞—Ä—Ç–æ—Ñ–µ–ª–µ–º –∏ –±–µ–∫–æ–Ω–æ–º"},
    ],
    "–ö–æ–ø—á–µ–Ω–∏–µ": [
      {name:"–ö–æ–ø—á–µ–Ω–∞—è —à–µ–π–∫–∞", img:"/images/smoked%20pork%20collar.jpeg", price:60, desc:"100 –≥—Ä–∞–º–º"},
      {name:"–ö–æ–ø—á–µ–Ω—ã–π –±–µ–∫–æ–Ω", img:"/images/smoked%20bacon1.jpeg", price:60, desc:"100 –≥—Ä–∞–º–º"},
      {name:"–ö–æ–ª–±–∞—Å–∞ –∫—Ä–∞–∫–æ–≤—Å–∫–∞—è", img:"/images/kolbasa%20svinaya1.jpeg", price:200, desc:"200 –≥—Ä–∞–º–º"},
      {name:"–ö–æ–ø—á–µ–Ω–∞—è –∫—É—Ä–∏—Ü–∞", img:"/images/kopchenaya%20kyrica1.jpeg", price:100, desc:"250 –≥—Ä–∞–º–º"},
      {name:"–ö–æ–ø—á–µ–Ω–∞—è –∫–æ—Ä–µ–π–∫–∞", img:"/images/Smoked%20pork%20loin1.jpeg", price:50, desc:"100 –≥—Ä–∞–º–º"},
    ],
  };

  /********************** RENDER TOP NAV **********************/
  const nav = document.getElementById('top-nav');
  const menuRoot = document.getElementById('menu-root');
  function renderTopNav(){
    const order = ["–°—É–ø—ã","–û—Å–Ω–æ–≤–Ω—ã–µ –±–ª—é–¥–∞","–°–∞–ª–∞—Ç—ã","–ì—Ä–∏–ª—å","–ó–∞–º–æ—Ä–æ–∑–∫–∞","–ö–æ–ø—á–µ–Ω–∏–µ"];
    for(const key of order){
      const b = document.createElement('button');
      b.className='nav-btn';
      b.textContent=key;
      b.onclick=()=>document.getElementById('cat-'+slug(key)).scrollIntoView({behavior:'smooth',block:'start'});
      nav.appendChild(b);
    }
  }

  /********************** RENDER MENU **********************/
  function slug(s){return s.toLowerCase().replace(/\s+/g,'-')}
  function renderMenu(){
    const frag = document.createDocumentFragment();
    const grid = document.createElement('div');
    grid.className='menu';

    // Build category sections
    Object.entries(CATEGORIES).forEach(([cat, items])=>{
      const anchor = document.createElement('div');
      anchor.id = 'cat-'+slug(cat);
      anchor.className='cat-title';
      anchor.textContent = cat;
      frag.appendChild(anchor);

      items.forEach(item=>{
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `
          <img src="${item.img}" alt="${item.name}" />
          <div class="card-body">
            <div class="title">${item.name}</div>
            <div class="desc">${item.desc}</div>
            <div class="price">${item.price} ‡∏ø</div>
            <button class="add-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>`;
        card.querySelector('.add-btn').onclick=()=>addToCart(item);
        grid.appendChild(card);
      });
    });

    menuRoot.appendChild(frag);
    menuRoot.appendChild(grid);
  }

  /********************** CART LOGIC **********************/
  const cartItemsEl = document.getElementById('cartItems');
  const itemsTotalEl = document.getElementById('items-total');
  const deliveryFeeEl = document.getElementById('delivery-fee');
  const grandTotalEl = document.getElementById('grand-total');
  const checkoutBtn = document.getElementById('checkoutBtn');

  let CART = {}; // key=name -> {qty, price, img}
  let deliveryFee = 0;
  let customer = {address:"", name:"", phone:""};

  function addToCart(item){
    if(!CART[item.name]) CART[item.name] = {qty:0, price:item.price, img:item.img};
    CART[item.name].qty++;
    renderCart();
  }
  function changeQty(name, delta){
    if(!CART[name]) return;
    CART[name].qty += delta;
    if(CART[name].qty<=0) delete CART[name];
    renderCart();
  }
  function renderCart(){
    cartItemsEl.innerHTML = '';
    let itemsTotal = 0;
    Object.entries(CART).forEach(([name, it])=>{
      const line = document.createElement('div');
      const lineTotal = it.qty * it.price;
      itemsTotal += lineTotal;
      line.className='cart-item';
      line.innerHTML = `
        <img src="${it.img}" alt="${name}" style="width:48px;height:48px;object-fit:cover;border-radius:8px"/>
        <div>
          <div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
            <strong>${name}</strong>
            <button class="remove" onclick="removeItem('${name.replace(/'/g,"\\'")}')">—É–¥–∞–ª–∏—Ç—å</button>
          </div>
          <div class="summary">${it.price} ‡∏ø √ó ${it.qty} = <strong>${lineTotal} ‡∏ø</strong></div>
        </div>
        <div class="qty">
          <button onclick="changeQty('${name.replace(/'/g,"\\'")}',-1)">‚àí</button>
          <span>${it.qty}</span>
          <button onclick="changeQty('${name.replace(/'/g,"\\'")}',1)">+</button>
        </div>`;
      cartItemsEl.appendChild(line);
    });
    itemsTotalEl.textContent = itemsTotal;

    // –≤–∫–ª—é—á–∞–µ–º –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞
    deliveryFee = customer.address ? DELIVERY_FEE_DEFAULT : 0;
    deliveryFeeEl.textContent = deliveryFee;
    grandTotalEl.textContent = itemsTotal + deliveryFee;

    checkoutBtn.disabled = !canCheckout();
  }
  function removeItem(name){ delete CART[name]; renderCart(); }
  function canCheckout(){
    const hasItems = Object.keys(CART).length>0;
    const hasContact = customer.address && validPhone(customer.phone);
    return hasItems && hasContact;
  }

  /********************** ADDRESS MODAL **********************/
  const addrModal = document.getElementById('addrModal');
  document.getElementById('addressTrigger').onclick = openAddrModal;
  document.getElementById('addrConfirm').onclick = confirmAddr;
  const addrSummary = document.getElementById('addressSummary');

  const addrInput = document.getElementById('addrInput');
  const nameInput = document.getElementById('nameInput');
  const phoneInput = document.getElementById('phoneInput');
  const addrConfirmBtn = document.getElementById('addrConfirm');

  // Tabs
  const tabManual = document.getElementById('tab-manual');
  const tabMap = document.getElementById('tab-map');
  const manualForm = document.getElementById('manualForm');
  const mapForm = document.getElementById('mapForm');

  tabManual.onclick = ()=>{
    tabManual.classList.add('active'); tabMap.classList.remove('active');
    manualForm.style.display='block'; mapForm.style.display='none';
  };
  tabMap.onclick = ()=>{
    tabMap.classList.add('active'); tabManual.classList.remove('active');
    manualForm.style.display='none'; mapForm.style.display='block';
    ensureMap();
  };

  function openAddrModal(){
    addrModal.style.display='flex';
    // preload existing
    addrInput.value = customer.address || '';
    nameInput.value = customer.name || '';
    phoneInput.value = customer.phone ? customer.phone.replace(/^\+66/,'') : '';
    updateAddrConfirmState();
  }
  function closeAddrModal(){ addrModal.style.display='none'; }

  function validPhone(p){ return /^\+66\d{9,10}$/.test(p); }
  function updateAddrConfirmState(){
    const addr = (addrInput.value || (customer.address||'')).trim();
    const phoneRaw = phoneInput.value.replace(/\D/g,'');
    const phone = '+66' + phoneRaw;
    const ok = addr.length>3 && validPhone(phone);
    addrConfirmBtn.disabled = !ok;
  }
  [addrInput, phoneInput, nameInput].forEach(el=>el.addEventListener('input', updateAddrConfirmState));

  function confirmAddr(){
    const phone = '+66' + phoneInput.value.replace(/\D/g,'');
    customer = {
      address: (addrInput.value || customer.address || '').trim(),
      name: nameInput.value.trim(),
      phone
    };
    addrSummary.innerHTML = `<div><strong>–ê–¥—Ä–µ—Å:</strong> ${escapeHtml(customer.address)}</div>
      <div><strong>–ò–º—è:</strong> ${escapeHtml(customer.name||'')}</div>
      <div><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${escapeHtml(customer.phone)}</div>`;
    closeAddrModal();
    renderCart();
  }

  function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

  /********************** GOOGLE MAPS (lazy init) **********************/
  let map, autocomplete, marker;
  function ensureMap(){
    if(map) return;
    const phuket = {lat:7.8804, lng:98.3923};
    map = new google.maps.Map(document.getElementById('map'), {center: phuket, zoom: 11});
    marker = new google.maps.Marker({map, position: phuket, draggable:true});
    const input = document.getElementById('placeSearch');
    autocomplete = new google.maps.places.Autocomplete(input, {fields:["formatted_address","geometry"]});
    autocomplete.addListener('place_changed', ()=>{
      const place = autocomplete.getPlace();
      if(!place.geometry) return;
      map.panTo(place.geometry.location);
      marker.setPosition(place.geometry.location);
      customer.address = place.formatted_address || '';
      addrInput.value = customer.address;
      updateAddrConfirmState();
    });
    map.addListener('click', (e)=>{ marker.setPosition(e.latLng); reverseGeocode(e.latLng); });
    marker.addListener('dragend', ()=> reverseGeocode(marker.getPosition()));
  }
  function reverseGeocode(latLng){
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({location:latLng}, (results,status)=>{
      if(status==='OK' && results[0]){
        customer.address = results[0].formatted_address;
        addrInput.value = customer.address; updateAddrConfirmState();
      }
    });
  }

  /********************** CHECKOUT / TIME PICK **********************/
  const timeModal = document.getElementById('timeModal');
  const timeConfirm = document.getElementById('timeConfirm');
  const timePickers = document.getElementById('timePickers');
  const hourSel = document.getElementById('hourSel');
  const minSel = document.getElementById('minSel');

  // Fill hour/minute selects (09:00 - 22:30)
  function fillTime(){
    if(hourSel.options.length) return;
    for(let h=9; h<=22; h++){
      const opt=document.createElement('option');
      opt.value=String(h).padStart(2,'0');
      opt.textContent=opt.value;
      hourSel.appendChild(opt);
    }
    for(let m=0; m<60; m+=15){
      const opt=document.createElement('option');
      opt.value=String(m).padStart(2,'0');
      opt.textContent=opt.value;
      minSel.appendChild(opt);
    }
  }

  checkoutBtn.onclick = ()=>{
    if(!canCheckout()) return alert('–î–æ–±–∞–≤—å—Ç–µ –±–ª—é–¥–∞ –∏ —É–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –∏ —Ç–µ–ª–µ—Ñ–æ–Ω.');
    fillTime();
    timeModal.style.display='flex';
  }
  function closeTimeModal(){ timeModal.style.display='none'; }

  document.querySelectorAll('input[name="ordertime"]').forEach(r=>{
    r.addEventListener('change', ()=>{
      timePickers.style.display = r.value==='scheduled' && r.checked ? 'grid':'none';
    });
  });

  timeConfirm.onclick = async ()=>{
    const mode = document.querySelector('input[name="ordertime"]:checked').value;
    let orderTime = 'soonest';
    let orderDate = new Date();
    if(mode==='scheduled'){
      const h = hourSel.value, m=minSel.value;
      const d = new Date();
      d.setHours(parseInt(h,10), parseInt(m,10), 0, 0);
      orderTime = `${h}:${m}`;
      orderDate = d;
    }
    closeTimeModal();
    await submitOrder(orderDate, orderTime, mode==='scheduled'?'scheduled':'soonest');
  };

  async function submitOrder(orderDate, orderTime, orderWhen){
    const items = {};
    let total = 0;
    Object.entries(CART).forEach(([name, it])=>{
      items[name] = {qty: it.qty, price: it.price};
      total += it.qty * it.price;
    });
    total += deliveryFee;

    const payload = {
      items,
      phone: customer.phone,
      name: customer.name,
      address: customer.address,
      delivery: deliveryFee,
      total,
      orderDate: orderDate.toISOString().slice(0,10),
      orderTime,
      orderWhen
    };

    try{
      const res = await fetch(ORDER_API_URL, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok){
        const txt = await res.text();
        alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞: '+res.status+'\n'+txt);
        return;
      }
      alert('–°–ø–∞—Å–∏–±–æ! –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.');
      // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
      CART = {}; renderCart();
    }catch(err){
      console.error(err);
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ/URL.');
    }
  }

  /********************** INIT **********************/
  renderTopNav();
  renderMenu();
  renderCart();

  // –ö–ª–∏–∫ –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –µ—ë
  [addrModal, timeModal].forEach(m=>{
    m.addEventListener('click', e=>{ if(e.target===m) m.style.display='none'; });
  });
</script>

<!-- –í–°–¢–ê–í–¨–¢–ï –≤–∞—à –∫–ª—é—á Google Maps –Ω–∏–∂–µ –≤–º–µ—Å—Ç–æ YOUR_GOOGLE_MAPS_API_KEY -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>
</body>
</html>
